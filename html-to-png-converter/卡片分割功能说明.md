# 🃏 卡片分割功能说明

## 功能概述

本项目新增了**卡片分割功能**，能够自动识别HTML中的多个卡片元素，并将每个卡片生成为独立的PNG图片文件。

## 功能特点

- ✅ **自动识别卡片**: 智能识别具有特定结构的卡片元素
- ✅ **批量转换**: 一次性将所有卡片转换为高清PNG图片
- ✅ **ZIP打包**: 自动将所有卡片图片打包成ZIP文件下载
- ✅ **高度自定义**: 支持自定义输出尺寸和缩放比例
- ✅ **处理统计**: 显示处理时间和生成的卡片数量

## 卡片识别规则

系统会按以下优先级识别卡片：

1. **主要选择器**: `.mb-12 > div[style*="width: 375px"]`
2. **备用选择器**: `.mb-12`
3. **尺寸识别**: `[style*="width: 375px; height: 812px"]`
4. **通用识别**: 包含 `.bg-white.rounded-2xl` 的div元素

## 使用方法

### 1. Web界面使用

1. 访问 `http://localhost:3003`
2. 在HTML内容框中输入包含多个卡片的HTML代码
3. 调整转换设置（宽度、高度、缩放比例）
4. 点击 **🃏 分割卡片** 按钮
5. 等待处理完成后，点击 **📥 下载所有卡片 (ZIP)** 下载结果

### 2. 示例模板

点击界面中的 **多卡片模板** 按钮可以快速加载示例HTML，体验卡片分割功能。

### 3. API调用

#### 端点
```
POST /api/split-cards
```

#### 请求参数
```json
{
  "html": "HTML内容字符串",
  "width": 1920,          // 视口宽度 (可选，默认1920)
  "height": 1080,         // 视口高度 (可选，默认1080)
  "scale": 2,             // 缩放倍数 (可选，默认2)
  "outputFormat": "zip"   // 输出格式 (可选，默认zip)
}
```

#### 响应
- **成功**: 返回包含所有卡片图片的ZIP文件
- **响应头**:
  - `X-Cards-Count`: 生成的卡片数量
  - `X-Processing-Time`: 处理时间（毫秒）

#### 错误响应
```json
{
  "success": false,
  "error": "错误信息"
}
```

## 支持的HTML结构

### 标准卡片结构
```html
<div class="mb-12">
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden" 
         style="width: 375px; height: 812px; margin: 0 auto;">
        <!-- 卡片内容 -->
    </div>
</div>
```

### 测试示例

1. **使用测试脚本**:
   ```bash
   node test-split-cards.js
   ```

2. **测试你的HTML文件**:
   - 将HTML文件命名为 `test_10.html` 放在上级目录
   - 运行测试脚本会自动读取并处理

## 文件输出

- **文件名格式**: `card_1.png`, `card_2.png`, `card_3.png` ...
- **压缩包名**: `cards.zip`
- **图片格式**: PNG (高清无损)

## 性能说明

- **处理速度**: 每个卡片约需要 1-3 秒处理时间
- **内存占用**: 根据卡片数量和复杂度动态调整
- **并发限制**: 使用浏览器池管理，最多同时处理3个请求
- **文件大小**: 每张卡片图片约 100KB-2MB（取决于内容复杂度）

## 故障排除

### 常见问题

1. **未找到任何卡片**
   - 检查HTML结构是否符合识别规则
   - 确保卡片容器有正确的CSS类名或样式

2. **某些卡片截图失败**
   - 可能是卡片内容过于复杂
   - 检查控制台日志获取详细错误信息

3. **处理时间过长**
   - 减少卡片数量或降低缩放比例
   - 简化卡片内的复杂CSS效果

### 调试信息

服务器会在控制台输出详细的处理信息：
```
找到 6 个卡片
卡片 1 截图完成
卡片 2 截图完成
...
卡片分割完成，耗时: 15234ms, 生成了 6 张图片
```

## 技术实现

- **后端**: Node.js + Express + Puppeteer
- **前端**: HTML + JavaScript + Tailwind CSS
- **图片处理**: Puppeteer截图引擎
- **压缩**: Archiver库
- **识别**: DOM选择器 + getBoundingClientRect()

## 更新日志

### v1.1.0 (2025-01-20)
- ✅ 新增卡片分割功能
- ✅ 添加ZIP打包下载
- ✅ 支持多种卡片识别规则
- ✅ 优化前端界面，新增分割按钮
- ✅ 添加多卡片模板示例
- ✅ 完善错误处理和状态显示

---

**开发者**: AI Assistant  
**项目**: HTML转PNG高清转换工具  
**功能**: 卡片自动分割与批量转换 