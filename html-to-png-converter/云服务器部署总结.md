# 🌐 云服务器部署总结

## 🎯 目标
通过 **http://144.34.227.86:3003** 访问HTML转PNG转换器（包含卡片分割功能）

## ✅ 当前状态
- PM2服务已启动 ✅
- 服务正在运行 (80.6mb内存) ✅
- Nginx配置失败（80端口被占用）❌

## 🚀 立即执行的操作

### 1. 上传修复后的文件到服务器
将以下修复后的文件上传到服务器：
- `public/script.js` (修复了前端JavaScript错误)
- `cloud-server-setup.md` (详细部署指南)
- `check-server.sh` (状态检查脚本)
- `setup-external-access.sh` (一键配置脚本)

### 2. 在服务器上执行配置
```bash
# 进入项目目录
cd /www/wwwroot/tools-all-for-me-main/html-to-png-converter

# 给脚本添加执行权限
chmod +x check-server.sh setup-external-access.sh

# 运行一键配置脚本（需要root权限）
sudo bash setup-external-access.sh

# 如果需要检查状态
bash check-server.sh
```

### 3. 配置云服务商安全组 ⭐ **最重要**
在您的云服务商控制台（阿里云/腾讯云/AWS等）：
1. 找到服务器实例
2. 进入安全组设置
3. 添加入站规则：
   - **协议**: TCP
   - **端口**: 3003
   - **来源**: 0.0.0.0/0
   - **动作**: 允许

## 🔧 手动配置防火墙（如果脚本失败）

### Ubuntu/Debian系统：
```bash
sudo ufw allow 3003/tcp
sudo ufw reload
sudo ufw status
```

### CentOS/RHEL系统：
```bash
sudo firewall-cmd --permanent --add-port=3003/tcp
sudo firewall-cmd --reload
sudo firewall-cmd --list-ports
```

## 📊 验证部署

### 1. 检查服务状态
```bash
pm2 list
netstat -tlnp | grep 3003
```

### 2. 测试本地连接
```bash
curl -I http://localhost:3003
curl http://localhost:3003/api/health
```

### 3. 测试外部访问
- 浏览器访问：**http://144.34.227.86:3003**
- API测试：**http://144.34.227.86:3003/api/health**

## 🎉 新功能：卡片分割
一旦部署成功，您可以：
1. 访问 http://144.34.227.86:3003
2. 点击 **"多卡片模板"** 加载示例
3. 点击 **"🃏 分割卡片"** 按钮
4. 下载生成的ZIP文件，包含分割后的卡片图片

## 🛠️ 故障排除

### 无法访问网站？
1. ✅ 检查PM2服务：`pm2 list`
2. ✅ 检查端口监听：`netstat -tlnp | grep 3003`
3. ✅ 检查防火墙：`sudo ufw status` 或 `sudo firewall-cmd --list-ports`
4. ⭐ **检查云服务商安全组设置**
5. ✅ 重启服务：`pm2 restart html-to-png-converter`

### 卡片分割功能出错？
1. 检查浏览器控制台是否有JavaScript错误
2. 确保已上传修复后的`script.js`文件
3. 查看PM2日志：`pm2 logs html-to-png-converter`

## 📋 需要的文件更新

请将以下文件从本地上传到服务器：
```
html-to-png-converter/
├── public/script.js (已修复)
├── cloud-server-setup.md (新增)
├── check-server.sh (新增)
├── setup-external-access.sh (新增)
└── 云服务器部署总结.md (本文件)
```

## 🎯 最终目标检查清单
- [ ] PM2服务运行正常
- [ ] 端口3003监听在0.0.0.0
- [ ] 服务器防火墙开放3003端口
- [ ] **云服务商安全组开放3003端口** ⭐
- [ ] 可以通过 http://144.34.227.86:3003 访问
- [ ] 卡片分割功能正常工作

---

**重要提醒**：最常见的问题是忘记配置云服务商的安全组！即使服务器防火墙配置正确，如果云服务商安全组没有开放端口，外部仍然无法访问。 